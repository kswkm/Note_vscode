조인(JOIN): 테이블 A의 열을 테이블 B에 포함하여 조회할 수 있도록 테이블 데이터를 조합하는 기능.
필요성: 잘 설계된 관계형 데이터베이스는 데이터 중복 저장을 최소화하기 위해 엔티티별로 테이블을 분리하며, 분리된 데이터를 함께 조회할 때 조인이 필요함.


#내부 조인 (INNER JOIN)
개념: 두 테이블 모두 조인 조건에 맞는 열만 조회하며, 가장 흔하게 사용되는 조인 방식.
다이어그램: 두 테이블의 교집합 부분.
기본 형식:
SELECT
[열]
FROM [테이블 1]
INNER JOIN [테이블 2] ON [테이블 1.열] = [테이블 2.열]
WHERE [검색 조건]
특징:
ON 절에 **조인키(공통 열)**를 지정하여 테이블을 결합함.
조인 조건은 2개 이상 사용할 수 있으며, AND, OR 연산자를 활용할 수 있음.
테이블 3개 이상도 조인 가능하며, 각 테이블 간의 공통된 열을 활용함.
내부 조인은 조건에 맞는 데이터만 조회하므로 NULL이 발생하지 않음.


#외부 조인 (OUTER JOIN)
개념: 두 테이블을 조인할 때, 한쪽 테이블에만 있는 데이터도 조회해야 하는 경우 사용. 열의 일치 여부를 고려하지 않고 조인함.
기본 형식:
SELECT
[열]
FROM [테이블 1]
[LEFT | RIGHT | FULL] OUTER JOIN [테이블 2] ON [테이블 1.열] = [테이블 2.열]
WHERE [검색 조건]
종류:
LEFT OUTER JOIN: 왼쪽 테이블을 기준으로 하여 오른쪽 테이블과 조인. 왼쪽 테이블의 모든 데이터는 포함되며, 오른쪽 테이블에 일치하는 데이터가 없으면 NULL로 표시됨.
RIGHT OUTER JOIN: 오른쪽 테이블을 기준으로 하여 왼쪽 테이블과 조인. 오른쪽 테이블의 모든 데이터는 포함되며, 왼쪽 테이블에 일치하는 데이터가 없으면 NULL로 표시됨.
FULL OUTER JOIN: 양쪽 테이블에서 일치하지 않는 행까지 모두 조회 (합집합).
주의: MySQL은 FULL OUTER JOIN을 지원하지 않아 LEFT OUTER JOIN과 RIGHT OUTER JOIN 결과를 UNION으로 합쳐서 구현함.
활용: 기준 테이블에만 존재하는 데이터(예: 주문하지 않은 고객)를 추출할 때, 외부 조인 결과에서 WHERE [조인된 테이블의 열] IS NULL 조건을 사용함.


#교차 조인 (CROSS JOIN)
개념: 각 테이블의 모든 경우의 수를 조합한 데이터를 조회하며, **카르테시안 곱(cartesian product)**이라고도 함.
기본 형식:
SELECT [열]
FROM [테이블 1]
CROSS JOIN [테이블 2]
WHERE [검색 조건]
특징: FROM 문에 별도의 조인 조건(ON 절)이 필요 없음. 샘플 데이터를 만들거나 모든 경우의 수 조합이 필요할 때 활용됨.
셀프 조인 (SELF JOIN)
개념: 동일한 테이블을 두 개의 테이블처럼 사용하여 조인하는 특수한 방식.
활용: 내부 조인 또는 외부 조인 구문을 사용하되, 반드시 **테이블 별칭(Alias)**을 사용하여 구분해야 함 (예: payment AS a, payment AS b).
예시: 전일 대비 수익 비교 등 동일 테이블 내의 행 간 비교에 유용.


#서브 쿼리의 특징
정의: 쿼리 안에 포함되어 있는 또 다른 쿼리. 조인하지 않은 상태에서 다른 테이블과 일치하는 행을 찾거나, 조인 결과를 다시 활용할 때 사용됨.
WHERE 문에 서브 쿼리 사용하기 (중첩 서브 쿼리)
목적: 주 쿼리의 조건값으로 사용.
단일 행 서브 쿼리:
결과: 서브 쿼리의 반환 결과가 1행만 반환되어야 함.
기본 형식:
SELECT [열] FROM [테이블]
WHERE [열] = (SELECT [열] FROM [테이블])
주의: 2행 이상 반환 시 오류 발생.


#다중 행 서브 쿼리
결과: 서브 쿼리 결과가 2행 이상 반환됨.
연산자: IN, NOT IN, ANY, ALL, EXISTS, NOT EXISTS 등의 다중행 연산자 사용 필수.
IN: 서브 쿼리 결과 집합 중 하나라도 만족하는 값과 일치하는 행을 조회.
ANY: 서브 쿼리 결과 중 하나라도 만족하는 조건을 주 쿼리에서 조회.
EXISTS: 서브 쿼리의 결괏값이 1행이라도 있으면 TRUE를 반환하여 주 쿼리를 실행함. (없으면 FALSE)
ALL: 서브 쿼리 결괏값에 있는 모든 값을 만족하는 조건으로 주 쿼리에서 검색함 (AND 연산처럼 동작).
연산자	설명	예시
IN	목록 값 중 하나와 일치	WHERE column IN (subquery)
NOT IN	목록 값 중 하나와도 일치하지 않음	WHERE column NOT IN (subquery)
= ANY	서브 쿼리 결과 중 하나와 같음	WHERE column = ANY (subquery)
< ANY	서브 쿼리 결과 중 최대값보다 작음	WHERE column < ANY (subquery)
> ANY	서브 쿼리 결과 중 최소값보다 큼	WHERE column > ANY (subquery)
EXISTS	서브 쿼리 결과가 존재함	WHERE EXISTS (subquery)
ALL	서브 쿼리 결과의 모든 값과 비교 조건 만족	WHERE column = ALL (subquery)


#FROM 문에 서브 쿼리 사용하기 (인라인 뷰, Inline View)
개념: 서브 쿼리의 결과가 테이블처럼 사용되어 다른 테이블과 조인하거나 쿼리를 논리적으로 격리하는 용도로 사용됨.
기본 형식:
SELECT
[열]
FROM [테이블] AS a
INNER JOIN (SELECT [열] FROM [테이블] WHERE [열] = [값]) AS b ON [a.열] = [b.열]
WHERE [열] = [값]
주의: FROM 절에 사용되는 서브 쿼리는 반드시 **별칭(Alias)**을 지정해야 함 (AS b 또는 AS x).


#SELECT 문에 서브 쿼리 사용하기 (스칼라 서브 쿼리, Scalar Subquery)
개념: SELECT 절의 열처럼 사용되는 서브 쿼리.
결과: 반드시 1개의 행을 반환해야 함.
활용: 주로 SUM, COUNT 등의 집계 함수와 함께 사용되나, 성능 문제로 권장되지 않기도 함.
기본 형식:
SELECT
[열], (SELECT <집계 함수> [열] FROM [테이블 2]
WHERE [테이블 2.열] = [테이블 1.열]) AS a
FROM [테이블 1]
WHERE [조건]
05-3 공통 테이블 표현식 (CTE, Common Table Expression)


#CTE
개념: 쿼리 실행 결과를 테이블처럼 활용하기 위한 논리적인 테이블. 실제 데이터베이스에 생성되는 테이블은 아니며, 바로 다음에 실행할 SELECT 문에만 사용할 수 있음.
목적: 복잡한 쿼리를 단순화하고 가독성을 높임.
일반 CTE
기본 형식:
WITH [테이블] (열 1, 열 2, ...)
AS
(
<SELECT 문>
)
SELECT [열] FROM [테이블];
구성:
WITH [테이블] (열 목록): CTE 테이블의 이름과 구성할 열 이름을 정의.


#AS (<SELECT 문>): CTE 테이블에 들어갈 데이터를 조회하는 쿼리.
결합: CTE 내부의 <SELECT 문>은 UNION, UNION ALL, INTERSECT, EXCEPT를 사용하여 여러 데이터 집합을 결합할 수 있음.
UNION ALL: 중복을 제거하지 않고 결과를 합침.
INTERSECT: 두 쿼리 결과의 교집합 (중복값)을 반환. (내부 조인과 유사하지만 중복값 반환이 특징)
EXCEPT: 첫 번째 SELECT 문을 기준으로 두 번째 SELECT 문과 중복되지 않는 차집합 데이터를 반환. (NOT IN과 유사)


#재귀 CTE (Recursive CTE)
개념: CTE 결과를 CTE 내부의 쿼리에서 재사용하여 반복 실행하는 쿼리 구조.
활용: 주로 조직도와 같은 계층 데이터를 검색할 때 사용됨 (예: 피보나치 수열 생성).
기본 형식:
WITH RECURSIVE [CTE_테이블](열 1, 열 2, …)
AS(
<SELECT * FROM 테이블 A>  -- 앵커 멤버
UNION ALL
<SELECT * FROM 테이블 B JOIN CTE_테이블> -- 재귀 멤버
)
SELECT * FROM [CTE_테이블];
구성 요소:
앵커 멤버 (Anchor Member): 재귀 CTE를 참조하지 않는 초기 쿼리.
재귀 멤버 (Recursive Member): CTE 자체를 참조하여 반복적으로 실행되는 쿼리.


